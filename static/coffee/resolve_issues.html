
<script id="resolve_issues-container-outer-template" type="text/x-handlebars-template">
  <h1>Resolve issues</h1>
  <div id="user-alert-space"></div>
  <div id="resolve_issues-container-inner-placeholder"></div>
</script>

<script id="resolve_issues-container-inner-template" type="text/x-handlebars-template">
  {{#if issues_exist}}
  <div class="issues"></div>
  {{else}}
  <p class="no-issues">No issues reported in the cluster.</p>
  {{/if}}
</script>

<script id="declare_machine_dead-modal-template" type="text/x-handlebars-template">
    <div class="alert alert-error">
        <h4 class="title_center">Warning</h4>
        <p>If you declare this server dead, you will not be able to reconnect it later, even if it does reconnect, it will consider itself dead and will stop working.</p>
        <p>All the data on the server will be lost.</p>
    </div>
    <div class="alert alert-error error_answer"></div>
    <p>Are you sure you want to declare <strong>{{machine_name}}</strong> dead?</p>
</script>

<script id="fail_solve_issue-template" type="text/x-handlebars-template">
    Sorry, something went wrong. The issue might not be up to date, please refresh.
</script>

<script id="declared_machine_dead-alert-template" type="text/x-handlebars-template">
  <div class="alert" data-alert="alert">
    <a class="close" href="#">&times;</a>
    <p>You successfully declared server <span class="name">{{machine_name}}</span> dead.</p>
  </div>
</script>

<script id="resolve_vclock-modal-template" type="text/x-handlebars-template">
  <div class="alert alert-error error_answer"></div>
  <p>Are you sure you want to use the value <strong>{{final_value}}</strong>?</p>
</script>

<script id="resolved_vclock-alert-template" type="text/x-handlebars-template">
  <div class="alert" data-alert="alert">
    <a class="close" href="#">&times;</a>
    <p>You successfully resolved the configuration value to <span class="name">{{final_value}}</span>.</p>
  </div>
</script>

<script id="resolve_unsatisfiable_goals_modal-template" type="text/x-handlebars-template">
    <div class="alert alert-error error_answer"></div>
    <p>Are you sure you want to lower the number of replicas for the datacenter</p>
    <ul>
    {{#each datacenters_with_issues}}
    <li>
        <a href="#datacenters/{{this.datacenter_id}}">{{this.datacenter_name}}</a> from <strong>{{this.num_replicas}}</strong> to <strong>{{num_machines}}</strong>
        {{#if this.change_ack}}
        <br />Warning: The number of acks will be lowered too.
        {{/if}}
    </li>
    {{/each}}
    <ul>
</script>


<script id="resolved_issues_unsatisfiable_goals-template" type="text/x-handlebars-template">
  <div class="alert" data-alert="alert">
    <a class="close" href="#">&times;</a>
    <p>You successfully solved the unsatisfiable goals issue.</p>
  </div>
</script>


<script id="resolve_issues-machine_down-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}}">
        <p class="datetime">{{prettify_date datetime}}</p>
        <h3 class="title">Server {{name}} is unreachable.</h3>
        {{#if no_responsibilities}}
            <p>This server has no master or replica responsibilities.</p>
        {{else}}
            {{#if masters}}
            <p>This server is responsible for the following shards:</p>
            <ul>
            {{#each masters}}
                <li>Namespace <a href="#tables/{{uuid}}">{{name}}</a> for the shard {{shard}}.</li>
            {{/each}}
            </ul>
            {{/if}}

            {{#if replicas}}
            <p>This server is a secondary for the following shards:</p>
            <ul>
            {{#each replicas}}
                <li>Namespace <a href="#tables/{{uuid}}">{{name}}</a> for the shard {{shard}}.</li>
            {{/each}}
            </ul>
            {{/if}}
        {{/if}}
        <p><button class="btn-solve">Declare Dead</button></p>
    </div>
</script>

<script id="resolve_issues-name_conflict-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}} name-conflict">
        <p class="datetime">{{prettify_date datetime}}</p>
        <h3 class="title">The name {{name}} is used by more than one {{type}}.</h3>

        <p>{{capitalize type}} with the name {{name}}:</p>
        <ul>
        {{#each contestants}}
        <li><a href="#{{pluralize_noun type 2}}/{{uuid}}"><span class="uuid">{{humanize_uuid uuid}}</span></a> (<a id="rename_{{uuid}}" href="#">rename</a>)</li>
        {{/each}}
        </ul>
    </div>
</script>

<script id="resolve_issues-logfile_write-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}}">
        <p class="datetime">{{prettify_date datetime}}</p>
        <h3 class="title">Can't write logs.</h3>

        <p>Log file is inaccessible on server <a href="/#servers/{{machine_uuid}}">{{machine_name}}</a>. Please resolve the issue on the server, or declare it dead.<p>
        <p><button class="btn-solve">Declare Dead</button></p>
    </div>
</script>
<script id="resolve_issues-vclock_conflict-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}} vclock-conflict">
        <p class="datetime">{{prettify_date datetime}}</p>
        <h3 class="title">Cluster configuration conflict.</h3>

        <p>This issue is caused by making changes to the cluster configuration on both sides of an intermittent network connection.</p>
        <p>{{capitalize field}} of {{object_type}} <a href="">{{#if name_contest}}{{humanize_uuid object_id}}{{else}}{{object_name}}{{/if}}</a> has the following conflicting values:</h4>
        <ul>
            {{#each contestants}}
            <li>{{value}} (<a id="resolve_{{contestant_id}}" href="#">use this value</a>)</li>
            {{/each}}
        </ul>
    </div>
</script>

<script id="resolve_issues-unsatisfiable_goals-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}}">
        <p class="datetime">{{prettify_date datetime}}</p>
        <h3 class="title">Unsatisfiable goals</h3>

        <p>The goals you have specified are impossible for the table <a href="#tables/{{namespace_id}}">{{namespace_name}}</a></p>
        {{#if no_primary}}<p>You have to <a href="#tables/{{namespace_id}}/replication">choose</a> a primary datacenter to make this table works.</p>{{/if}}

        {{#each datacenters_with_issues}}
        <p class="description">You require {{this.num_replicas}} {{pluralize_noun "replica" this.num_replicas}} for the datacenter <a href="#datacenters/{{this.datacenter_id}}">{{this.datacenter_name}}</a> but you only have {{num_machines}} {{pluralize_noun "server" this.num_machines}} available.</p>
        {{/each}}
        {{#if datacenters_with_issues}}
        <p class="description">To solve this issue, you can lower the number of replicas or connect a new server to the datacenter.</p>

        <p><button class="btn-solve">Lower the number of replicas</button></p>
        {{/if}}
  </div>
</script>



<script id="resolve_issues-machine_ghost-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}}">
        <p class="datetime">{{prettify_date datetime}}</p>
        <h3 class="title">Zombie server</h3>

        <p>A server was declared dead, but is now connected to the cluster.</p>
        <p class="description">Server's id: <a href="#servers/{{machine_id}}">{{machine_name}}</a><br/>
        Please manually remove it (by killing the rethinkDB instance for example)</p>
  </div>
</script>

<script id="resolve_issues-port_conflict-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}}">
        <p class="datetime">{{prettify_date datetime}}</p>
        <h3 class="title">Could not bind to port</h3>

        <p>A necessary port is already in use on this server</p>
        <p class="description">
        Server <a href="#servers/{{machine_id}}">{{machine_name}}</a> {{description}}.<br/>
        Some other process is likely using this port. Kill it or instruct it to release the port in order to resolve this issue.
        </p>
    </div>
</script>


<script id="resolve_issues-unknown-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}}">
        <p class="datetime">{{prettify_date datetime}}</p>
        <h3 class="title">Unknown issue: {{issue_type}}</h3>

        <p>An issue was sent by the server, but we could not parse it.</p>
        <p>Raw data: {{raw_data}}</p>
    </div>
</script>

