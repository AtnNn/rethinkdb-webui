<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>RethinkDB Administration</title>
        <meta name="description" content="">
        <meta name="author" content="">
        <meta http-equiv="no-cache">
        <meta http-equiv="Expires" content="-1">
        <meta http-equiv="Cache-Control" content="no-cache">

        <link rel="stylesheet" type="text/css" href="gen/cluster.css" />

        <!-- handlebars templates -->
        <script id="navbar_view-template" type="text/x-handlebars-template">
          <div id="topbar" class="navbar">
            <div class="navbar-inner">
              <div class="container">
                <a class="brand" href="#">RethinkDB Administration Console</a>
                <ul class="nav">
                  <li id="nav-dashboard"><a href="#dashboard">Dashboard</a></li>
                  <li id="nav-namespaces"><a href="#namespaces">Namespaces</a></li>
                  <li id="nav-servers"><a href="#servers">Servers</a></li>
                </ul>

                <ul class="right-nav nav pull-right">
                  <li class="divider-vertical"></li>
                  <li>
                    <form class="navbar-search pull-right">
                      <input type="text" class="search-query" placeholder="Search" data-provide="typeahead">
                    </form>
                  </li>
                </ul>
              </div><!-- /container -->
            </div><!-- /navbar-inner -->
          </div><!-- /navbar -->
        </script>

        <script id="dashboard_view-template" type="text/x-handlebars-template">
            <h1>Cluster dashboard</h1>
            <div class="section">
              <div class="machines"></div>
              <div class="data-picker"></div>
            </div>
            <div class="visualizations section">
                <hr class="first" />
                <div class="row-fluid">
                    <div class="disk span6">
                        <h3 class="title">Disk usage</h3>
                        <div class="disk-usage"></div>
                    </div>
                    <div class="memory span6">
                        <h3 class="title">Memory usage</h3>
                        <div class="mem-usage"></div>
                    </div>
                </div>
                <hr />
                <h3 class="title">Cluster performance</h3>
                <div class="chart cluster-performance"></div>
            </div>
        </script>

        <script id="data_picker-template" type="text/x-handlebars-template">
            <ul class="nav nav-tabs">
                {{#each stream_filters}}
                <li class="{{#if this.selected}}active{{/if}}" data-filter="{{this.name}}"><a href="#">{{this.name}}</a></li>
                {{/each}}
            </ul>
            <div class="filter">
            </div>
        </script>

        <script id="vis_loading-template" type="text/x-handlebars-template">
            <div class="loading"><h4>Loading data...</h4><img src="/images/loading.gif" /></div>
        </script>

        <script id="data_stream_filter-template" type="text/x-handlebars-template">
            {{#each models}}
                <div class="model" style="background:{{this.color}}" data-id="{{this.id}}">
                    <input {{#if this.selected}}checked="true"{{/if}} type="checkbox" />
                    {{this.name}}
                </div>
            {{/each}}
        </script>

        <script id="vis-graph_stream_picker-template" type="text/x-handlebars-template">
            <form class="stream-picker">
            {{#each datastreams}}
                <div class="datastream" data-id="{{this.id}}">
                    <input {{#if this.selected}}checked="true"{{/if}} type="radio" name="graph-data-stream"/>
                    {{this.name}}
                </div>
            {{/each}}
            </form>
        </script>

        <script id="vis_no_data-template" type="text/x-handlebars-template">
            <p class="no-data">No data selected.</p>
        </script>

        <script id="data_stream_filter-template" type="text/x-handlebars-template">
            {{#each models}}
                <div class="model" style="background:{{this.color}}" data-id="{{this.id}}">
                    <input {{#if this.selected}}checked="true"{{/if}} type="checkbox" />
                    {{this.name}}
                </div>
            {{/each}}
        </script>

        <!-- Cluster view: lists -->
        <script id="abstract_list-template" type="text/x-handlebars-template">
            <div class="actions-bar">
            </div>
            <table class="table table-bordered table-striped" cellpadding="0" cellspacing="0">
                <tbody>
                </tbody>
            </table>
        </script>

        <script id="namespace_list-template" type="text/x-handlebars-template">
            <h1>Namespaces in the cluster</h1>
            <div id="user-alert-space"></div>
            <div class="actions-bar">
                <a href="#" class="btn add-namespace">Add namespace</a>
                <a href="#" class="btn for-multiple-elements disabled remove-namespace">Remove selected namespaces</a>
            </div>
            <div class="namespace-list">
                <table class="table table-bordered table-striped" cellpadding="0" cellspacing="0">
                    <tbody class="list">
                    </tbody>
                </table>
            </div>
        </script>

        <script id="server_list-template" type="text/x-handlebars-template">
            <h1>Servers connected to the cluster</h1>
            <div id="user-alert-space"></div>
            <div class="actions-bar">
                <a href="#" class="btn add-datacenter">Add datacenter</a>
                <a href="#" class="btn for-multiple-elements disabled set-datacenter">Set datacenter</a>
            </div>
            <div class="server-list list">
                <div class="datacenters"></div>
                <div class="unassigned-machines"></div>
            </div>
        </script>

        <script id="machine_list-template" type="text/x-handlebars-template">
            <table class="table table-bordered table-striped" cellpadding="0" cellspacing="0">
                <tbody class="list">
                </tbody>
            </table>
        </script>

        <!-- Cluster view: list elements -->
        <script id="namespace_list_element-template" type="text/x-handlebars-template">
            <td>
                <input type="checkbox"></input>
            </td>
            <td>
                <div class="details">
                    <h3 class="name"><a href="#namespaces/{{id}}">{{name}}</a></h3>
                    <span class="protocol {{protocol}}">{{protocol}}</span>
                    <p><span class="status">Status: {{reachability}} ({{nashards}} of {{nshards}} masters live; {{nareplicas}} of {{nreplicas}} replicas live)</span></p>
                    <p><span class="contains">Contains: {{nshards}} {{pluralize_noun "shard" nshards}}, {{nreplicas}} {{pluralize_noun "replica" nreplicas}} on {{ndatacenters}} {{pluralize_noun "datacenter" ndatacenters}} across {{nmachines}} {{pluralize_noun "machine" nmachines}}</span></p>
                    <p><span class="replication">Replication: {{> backfill_progress_summary}}</span></p>
                </div>
                <div class="clearboth"></div>
            </td>
        </script>

        <script id="datacenter_list_element-template" type="text/x-handlebars-template">
            <div class="row header">
                <div class="span7">
                    {{#unless no_machines}}
                        <div class="expanded arrow"></div>
                    {{/unless}}
                    <h3 class="datacenter name"><span class="element-type label label-inverse">Datacenter</span><a href="#datacenters/{{id}}">{{name}}</a></h3>
                    <div class="datacenter details">
                        <p class="status">{{humanize_datacenter_reachability status}}</p>
                        <p class="contains">Primaries: {{primary_count}}, Secondaries: {{secondary_count}}, Namespaces: {{namespace_count}}</p>
                    </div>
                </div>
                <div class="span2">
                    <div class="datacenter actions">
                        <p>(<a href="#" class="remove-datacenter">remove this datacenter</a>)</p>
                    </div>
                </div>
            </div>
            {{#unless no_machines}}
                <div class="machine-list"></div>
            {{/unless}}
            <div class="divider"></div>
        </script>

        <script id="unassigned_machines_list_element-template" type="text/x-handlebars-template">
            {{# unless no_machines}}
                <div class="header">
                    <div class="expanded arrow"></div>
                    <h3 class="datacenter name">Unassigned machines</h3>
                </div>
                <div class="machine-list"></div>
                <div class="summary expanded"></div>
            {{/unless}}
        </script>

        <script id="machine_list_element-template" type="text/x-handlebars-template">
            <td>
                <input type="checkbox"></input>
            </td>
            <td>
                <div class="machine details">
                    <h3 class="name">
                        <span class="element-type label label-info">Machine</span><a href="#machines/{{id}}">{{name}}</a>
                        <p class="status">{{humanize_machine_reachability status}}</p>
                    </h3>
                    {{#unless unassigned_machine}}
                        <p class="contains">Primaries: {{primary_count}}, Secondaries: {{secondary_count}}, Namespaces: {{namespace_count}}</p>
                    {{/unless}}
                </div>
            </td>
        </script>

        <!-- Namespace view -->
        <script id="namespace_view-container-template" type="text/x-handlebars-template">
            <h1>Namespace overview for {{name}}</h1>
            <div id="user-alert-space"></div>
            <div class="profile-holder"></div>
            <h3 class="title">Replication settings</h3>
            <div class="section replication"></div>
            <h3 class="title">Sharding settings</h3>
            <div class="section sharding"></div>
            <h3 class="title">Recent log entries</h3>
            <div class="section recent-actions"></div>
        </script>

        <script id="namespace_view-profile-template" type="text/x-handlebars-template">
            <div class="two-panel-section">
              <div class="panel-left">
                <h3 class="title">Namespace profile</h3>
                <div class="section summary">
                  <p class="protocol">Protocol: {{protocol}}</p>
                  <p class="port">Port: {{port}}</p>
                </div>
              </div>
              <div class="panel-right">
                <h3 class="title">Namespace status</h3>
                <div class="section summary">
                  <p>Status: {{reachability}}</p>
                  <p>Masters: {{nashards}} of {{nshards}} reachable</p>
                  <p>Replicas: {{nareplicas}} of {{nreplicas}} reachable</p>
                  <p>Replication: {{> backfill_progress_summary}}</p>
                </div>
              </div>
              <div class="two-panel-clear"></div>
            </div>
        </script>
        <script id="namespace_view-replica-template" type="text/x-handlebars-template">
            <table class="datacenters table">
                <!-- Header row -->
                <tr>
                    <th>Datacenter</th>
                    <th>Role</th>
                    <th>Replicas</th>
                    <th>Write acks</th>
                    <th>Status</th>
                    <th>&nbsp;</th>
                </tr>
                <!-- Primary datacenter -->
                {{#with primary}}
                <tr>
                    <td>{{name}}</td>
                    <td>Primary</td>
                    <td>{{replicas}} (of {{total_machines}} {{pluralize_noun "machine" total_machines}})</td>
                    <td>{{acks}}</td>
                    <td>
                      {{#with status}}
                      <span class="master-status">{{nashards}} of {{nshards}} masters live</span>
                      {{#if nreplicas}}
                      <span class="replica-status">{{nareplicas}} of {{nreplicas}} replicas live</span>
                      {{/if}}
                      <span class="replication-status">{{> backfill_progress_summary}}</span>
                      {{/with}}
                    </td>
                    <td><a id="edit-primary" href="#">Edit replicas</a></td>
                </tr>
                {{/with}}
                <!-- Secondary datacenters -->
                {{#each secondaries}}
                <tr>
                    <td>{{name}}</td>
                    <td>Secondary</td>
                    <td>{{replicas}} (of {{total_machines}} {{pluralize_noun "machine" total_machines}})</td>
                    <td>{{acks}}</td>
                    <td>
                      {{#with status}}
                      <span class="replica-status">{{nareplicas}} of {{nreplicas}} replicas live</span>
                      <span class="replication-status">{{> backfill_progress_summary}}</span>
                      {{/with}}
                    </td>
                    <td><a class="edit-secondary {{this.id}}" href="#">Edit replicas</a> | <a class="make-primary {{this.id}}" href="#">Make primary</a></td>
                </tr>
                {{/each}}
                <!-- Rest of the datacenters (ones we're not replicating to) -->
                {{#each nothings}}
                <tr>
                    <td>{{name}}</td>
                    <td>None</td>
                    <td colspan="3">N/A</td>
                    <td><a class="edit-nothing {{this.id}}" href="#">Edit replicas</a></td>
                </tr>
                {{/each}}
            </table>
        </script>

        <script id="modify_replicas-modal-template-outer" type="text/x-handlebars-template">
        <div class="modal modify-replicas">
            <form class="form">
                <div class="modal-header">
                    <a href="#" class="close">&times;</a>
                    <h3>Replication for namespace <a href="/#namespaces/{{namespace.id}}">{{namespace.name}}</a> in datacenter <a href="/#datacenters/{{datacenter.id}}">{{datacenter.name}}</a></h3>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                                <button class="btn primary commit-plan" type="submit" name="commit-plan" value="Commit plan">Commit changes</button>
                    <a href="#" class="btn modify-replicas cancel">Cancel</a>
                </div>
            </form>
        </div>
        </script>
        
        <script id="modify_replicas-modal-template-inner" type="text/x-handlebars-template">
          <div class="replica-attributes">
          {{#if error_msg}}
          <p class="server-error alert alert-error"> {{error_msg}} </p>
          {{/if}}
          <div class="info">
            <p>You can specify the <strong>number of replicas</strong> to use per shard for this datacenter.</p>
            <p>The <strong>number of acks</strong> specifies how many replicas in this datacenter must acknowledge a write before an operation succeeds.</p>
          </div>
          <fieldset>
            <input name="datacenter" type="hidden" value="{{datacenter.id}}" />
            <div class="clearfix">
              <label for="replicas">
                <h4>Number of replicas:</h4>
              </label>
              <div class="input">
                <input class="xlarge" name="num_replicas" type="text" value="{{num_replicas}}"/>
                <p class="current">Current replicas: {{num_replicas}}</p>
                <p class="max">Max replicas: {{total_machines}}</p>
              </div>
            </div>
            <hr />
            <div class="clearfix">
              <label for="acks">
                <h4>Number of acks:</h4>
              </label>
              <div class="input">
                <input class="xlarge" name="num_acks" type="text" value="{{num_acks}}"/>
                <p class="current">Current acks: {{num_acks}}</p>
              </div>
          </fieldset>
          <div class="clearboth"></div>
          </div>
          </div>
        </script>

        <script id="modify_replicas_modal-replica_plan-template" type="text/x-handlebars-template">
            {{#with replicas }}
                {{#if adding}}
                    <h4 class="replicas">Adding {{num_changed}} replicas</h4>
                {{else}}
                    {{#if removing}}
                        <h4>Removing {{num_changed}} replicas</h4>
                    {{else}}
                        <h4>No replica changes</h4>
                    {{/if}}
                {{/if}}
                <table class="shards table">
                    <tbody>
                    </tbody>
                </table>
            {{/with}}
            {{#with acks }}
                <h5 class="acks">Replicas on this datacenter will require {{num}} acks.</h5>
            {{/with}}
        </script>

        <script id="backfill_progress_summary-partial" type="text/x-handlebars-template">
{{#if backfill_progress}}replicating{{#if backfill_progress.ratio_available}}{{#if backfill_progress.backfiller_machines}} from {{#comma_separated backfill_progress.backfiller_machines}}<a href="/#machines/{{machine_id}}">{{machine_name}}</a>{{/comma_separated}}{{/if}}{{/if}}{{else}}up to date{{/if}}
        </script>
        
        <script id="backfill_progress_details-partial" type="text/x-handlebars-template">
          {{#if backfill_progress}}
          {{#if backfill_progress.ratio_available}}
          <div class="progress progress-striped active">
            <div class="bar"
                 style="width: {{backfill_progress.percentage}}%;"></div>
          </div>
          <p>{{backfill_progress.percentage}}%{{#if backfill_progress.block_info_available}}, {{backfill_progress.replicated_blocks}} of {{backfill_progress.total_blocks}} blocks remaining{{/if}}</p>
          {{else}}
          <p>Replication progress information is unavailable.</p>
          {{/if}}
          {{/if}}
        </script>
        <script id="namespace_view-sharding-template" type="text/x-handlebars-template">
            <table class="shards table">
                <tbody>
                    {{#each shards}}
                        <tr>
                            <td class="name"><h4>{{name}}</h4></td>
                            <td class="status">
                                <p>
                                  <strong>Master:</strong> <a href="/#machines/{{primary.uuid}}">{{primary.name}}</a> {{humanize_machine_reachability primary.status}}{{#if primary.status.reachable}}{{> backfill_progress_summary primary}}{{/if}}</span>
                                  <br />
                                  {{> backfill_progress_details primary}}
                                  <a id="assign_master_{{index}}" href="#">Assign master</a>
                                </p>
                                  {{#if secondaries}}
                                  {{#each secondaries}}
                                    <p><strong>Replicas in datacenter <a href="/#datacenters/{{datacenter_uuid}}">{{datacenter_name}}</a>:</strong></p>
                                    <ul>
                                    {{#each machines}}
                                    <li>
                                      <p>
                                        <a href="/#machines/{{uuid}}">{{name}}</a>
                                        <span>{{humanize_machine_reachability status}}{{#if status.reachable}}{{> backfill_progress_summary}}{{/if}}</span>
                                      </p>
                                      {{> backfill_progress_details}}
                                    </li>
                                    {{/each}}
                                    </ul>
                                    <a id="assign_machines_{{../index}}_{{datacenter_uuid}}" href="#">Assign machines</a>
                                    <hr />
                                  {{/each}}
                                  {{else}}
                                  This shard has no replicas.
                                  {{/if}}
                            </td>
                        </tr>
                    {{/each}}
                </tbody>
            </table>
            <p><a class="edit" href="#">Change sharding scheme</a></p>
        </script>

        <script id="modify_shards_modal-template" type="text/x-handlebars-template">
            <div class="modal modify-shards">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Sharding for namespace <a href="/#namespaces/{{namespace.id}}">{{namespace.name}}</a></h3>
                    </div>
                    <div class="modal-body">
                        <div class="sharding-scheme">
                            <h4>Define the sharding scheme:</h4>
                            <table class="shards table">
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        <div class="sharding-plan"></div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary commit-plan" type="submit" name="commit-plan" value="Commit plan">Commit plan</button>
                        <a href="#" class="btn modify-shards cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>

        <script id="modify_shards_modal-shard-template" type="text/x-handlebars-template">
            {{#with shard}}
                <td class="name"><h4>{{name}}</h4></td>
                <td class="status">
                    <!-- TODO fake -->
                    <p>4 of 5 replicas live</p>
                    <p>50.3 GB of data in this shard</p>
                </td>
                <td class="actions">
                    <p>
                        (<a href="#" class="split" data-index="{{index}}">split</a>)
                        {{#if notlast}}
                            (<a href="#" class="merge" data-index="{{index}}">merge with next</a>)
                        {{/if}}
                    </p>
                </td>
            {{/with}}
        </script>

        <script id="modify_shards_modal-edit_shard-template" type="text/x-handlebars-template">
            <td class="name">
                {{#with shard}}
                    <h4>{{name}} </h4>
                {{/with}}
            </td>
            <td class="status" colspan="2">
                <!-- TODO fake -->
                <p>4 of 5 replicas live</p>
                <p>50.3 GB of data in this shard</p>
                <div class="action">
                    {{#if splitting}}
                        <label for="splitpoint">
                            <p>Split point:</p>
                        </label>
                        <input class="small" name="splitpoint" type="text" />
                        <a href="#" class="btn commit_split primary">Split</a>
                        <a href="#" class="btn cancel_split secondary">Cancel</a>
                    {{/if}}
                    {{#if merging}}
                        <p>
                            <a href="#" class="btn commit_merge primary">Yes</a>
                            <a href="#" class="btn cancel_merge secondary">No</a>
                            Are you sure you want to merge the shards <strong>{{low_shard}}
                                </strong> and <strong>{{high_shard}}</strong>?
                        </p>
                    {{/if}}
                </div>
            </td>
        </script>


        <script id="modify_shards-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>You successfully modified the shard plan. Machine assignments for this namespace have been reset.</p>
            </div>
        </script>

        <!-- Datacenter view -->
        <script id="datacenter_view-container-template" type="text/x-handlebars-template">
            <h1>Datacenter overview for {{name}}</h1>
            <div class="two-panel-section">
              <div class="panel-left">
                <h3 class="title">Datacenter profile</h3>
                <div class="section summary">
                  <p class="status">Status: {{humanize_datacenter_reachability status}}</p>
                </div>
              </div>
              <div class="panel-right">
                <h3 class="title">Datacenter resources</h3>
                <div class="section system-resources">
                  <p class="cpu">CPU: <span class="cpu-graph" values="{{cpu}}, {{cpu}}"></span></p>
                  <p class="ram">RAM:</p>
                  <p class="disk">Disk:</p>
                </div>
              </div>
              <div class="two-panel-clear"></div>
            </div>
            <h3 class="title">Machines</h3>
            <div class="section dc-machine-list">
              <ul>
                {{#each machines}}
                <li><a href='#machines/{{id}}'>{{name}}</a> {{humanize_machine_reachability status}}</li>
                {{/each}}
              </ul>
            </div>
            <h3 class="title">Data in this datacenter</h3>
            <div class="section data">
              {{#unless data.namespaces}}
              <p>No data found in this datacenter.</p>
              {{/unless}}
              {{#each data.namespaces}}
              <div class="namespace">
                <h4>Shards for namespace <a href="/#namespaces/{{uuid}}">{{name}}</a>:</h4>
                <ul>
                  {{#each shards}}
                  <li>{{name}} ({{nprimaries}} {{pluralize_noun "primary" nprimaries}}, {{nsecondaries}} {{pluralize_noun "secondary" nsecondaries}})</li>
                  {{/each}}
                </ul>
              </div>
              {{/each}}
            </div>
            <h3 class="title">Performance</h3>
            <div class="section performance-graph"></div>
            <h3 class="title">Recent log entries</h3>
            <div class="section recent-actions"></div>
        </script>

        <!-- Machine view -->
        <script id="machine_view-container-template" type="text/x-handlebars-template">
            <h1>Machine overview for {{name}}</h1>
            <div id="user-alert-space"></div>
            <div class="two-panel-section">
              <div class="panel-left">
                <h3 class="title">Machine profile</h3>
                <div class="section summary">
                  <p class="datacenter-name">Datacenter:
                    {{#if assigned_to_datacenter}}
                    <a href="#datacenters/{{datacenter_uuid}}">{{datacenter_name}}</a>
                    {{else}}
                    Unassigned 
                    {{/if}}
                    (<a class="set-datacenter" href="#">change</a>)
                  </p>
                  <p>Status: {{humanize_machine_reachability status}}</p>
                  <p>IP address: {{ip}}</p>
                  <p class="uptime">Uptime: {{uptime}}</p>
                </div>
              </div>
              <div class="panel-right">
                <h3 class="title">Machine resources</h3>
                <div class="section system-resources">
                  <p class="cpu">CPU: <span class="cpu-graph" values="{{cpu}}, {{cpu}}"></span></p>
                  <p class="ram">RAM:</p>
                  <p class="disk">Disk:</p>
                </div>
              </div>
              <div class="two-panel-clear"></div>
            </div>
            <h3 class="title">Data on this machine</h3>
            <div class="section data">
              {{#unless data.namespaces}}
              <p>No data found on this machine.</p>
              {{/unless}}
              {{#each data.namespaces}}
              <div class="namespace">
                <h4>Shards for namespace <a href="/#namespaces/{{uuid}}">{{name}}</a>:</h4>
                <ul>
                  {{#each shards}}
                  <li>{{name}} ({{humanize_role role}})</li>
                  {{/each}}
                </ul>
              </div>
              {{/each}}
            </div>
            <h3 class="title">Performance</h3>
            <div class="section performance-graph"></div>
            <h3 class="title">Recent log entries</h3>
            <div class="section recent-actions"></div>
        </script>

        <!-- Sidebar -->
        <script id="sidebar-container-template" type="text/x-handlebars-template">
            <div class="section cluster-status">
                <div class="client-connection-status"></div>
                <hr />
                <div class="issues"></div>
                <hr />
                <!-- Connectivity status goes here -->
                <div class="connectivity-status">
                </div>
            </div>
            <div class="section last">
                <h3>Recent log entries</h3>
                <div class="recent-events"></div>
                <p><a href="#events">See all recent log entries &rarr;</a></p>
            </div>
        </script>
        <script id="sidebar-client_connection_status-template" type="text/x-handlebars-template">
            {{#if disconnected}}
                <h5 class="connection disconnected">Disconnected</h5>
            {{else}}
                <h5 class="connection connected">Connected to:</h5>
                <h5 class="connected-to">{{machine_name}} in {{datacenter_name}}</h5>
            {{/if}}
        </script>
        <script id="sidebar-issues-template" type="text/x-handlebars-template">
            {{#if critical_issues.exist}}
                <h5 class="critical">Critical issues</h5>
                <div class="critical-issues">
                {{#each critical_issues.types}}
                    <div class="critical-issues">
                        <div class="priority"></div>
                        <div class="message">
                            {{#if MACHINE_DOWN}}{{num}} {{pluralize_noun "machine" num}} {{pluralize_verb_to_be num}} down{{/if}}
                            {{#if PERSISTENCE_ISSUE}}{{num}} {{pluralize_noun "disk" num}} {{pluralize_verb_to_be num}} inaccessible{{/if}}
                        </div>
                    </div>
                {{/each}}
                </div>
            {{/if}}
            {{#if other_issues.exist}}
                <h5 class="other">Non-critical issues</h5>
                <div class="critical-issues">
                    <div class="priority"></div>
                    <div class="message">
                        {{other_issues.num}} other {{pluralize_noun "issue" other_issues.num}}
                    </div>
                </div>
            {{/if}}
            {{#if no_issues}}
                <h5 class="no-issues">No issues reported</h5>
            {{else}}
                {{#if show_resolve_issues}}
                    <p class="resolve-issues"><a href="#resolve_issues">Resolve issues</a></p>
                {{/if}}
            {{/if}}
        </script>
        <script id="sidebar-connectivity_status-template" type="text/x-handlebars-template">
          <h5 class="cluster">Cluster status</h5>
          <div class="connectivity-info">
            <p class="metrics"><strong>{{machines_active}}</strong> of <strong>{{machines_total}}</strong> machines reachable.</p>
            <p class="metrics"><strong>{{datacenters_active}}</strong> of <strong>{{datacenters_total}}</strong> data centers reachable.</p>
          </div>
        </script>
        <script id="sidebar-event-template" type="text/x-handlebars-template">
            <div class="priority {{priority}}"></div>
            <div class="message">{{message}}</div>
            <p class="datetime"><abbr class="timeago" title="{{datetime}}">{{datetime}}</abbr></p>
        </script>

        <!-- Resolve issues view -->
        <script id="resolve_issues-container-outer-template" type="text/x-handlebars-template">
            <h1>Resolve issues</h1>
            <div id="user-alert-space"></div>
            <div id="resolve_issues-container-inner-placeholder"></div>
        </script>
        <script id="resolve_issues-container-inner-template" type="text/x-handlebars-template">
            {{#if issues_exist}}
                <div class="issues"></div>
            {{else}}
                <p class="no-issues">No issues reported in the cluster.</p>
            {{/if}}
        </script>
        <script id="resolve_issues-machine_down-template" type="text/x-handlebars-template">
            <div class="issue {{#if critical }}critical{{/if}}">
                <div class="header">
                    <h3 class="title">Machine {{name}} is unreachable.</h3>
                    {{#if datetime}}
                        <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
                    {{/if}}
                </div>
                <hr />
                {{#if no_responsibilities}}
                <h4>This machine has no master or replica responsibilities.</h4>

                {{else}}

                <!-- Masters -->
                {{#if masters}}
                <h4>This machine is responsible for the following masters:</h4>
                <ul>
                {{#each masters}}
                    <li>Namespace <a href="#namespaces/{{uuid}}">{{name}}</a> for the shard {{shard}}.</li>
                {{/each}}
                </ul>
                {{else}}
                <h4>This machine has no master responsibilities.</h4>
                {{/if}}

                <!-- Replicas -->
                {{#if replicas}}
                <h4>This machine is responsible for the following replicas:</h4>
                <ul>
                {{#each replicas}}
                    <li>Namespace <a href="#namespaces/{{uuid}}">{{name}}</a> for the shard {{shard}}.</li>
                {{/each}}
                </ul>
                {{else}}
                <h4>This machine has no replica responsibilities.</h4>
                {{/if}}

                {{/if}}

                <p><a class="btn large danger">Declare Dead</a></p>
            </div>
        </script>
        <script id="resolve_issues-name_conflict-template" type="text/x-handlebars-template">
            <div class="issue {{#if critical }}critical{{/if}} name-conflict">
                <div class="header">
                    <h3 class="title">The name {{name}} is used by more than one {{type}}.</h3>
                    {{#if datetime}}
                        <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
                    {{/if}}
                </div>
                <hr />
                <h4>{{pluralize_noun type num_contestants true}} with the name {{name}}:</h4>
                <ul>
                {{#each contestants}}
                <li><a href="#{{pluralize_noun type 2}}/{{uuid}}"><span class="uuid">{{humanize_uuid uuid}}</span></a> (<a id="rename_{{uuid}}" href="#">rename</a>)</li>
                {{/each}}
                </ul>
            </div>
        </script>
        <script id="resolve_issues-persistence-template" type="text/x-handlebars-template">
            <div class="issue {{#if critical }}critical{{/if}}">
                <div class="header">
                    <h3 class="title">Persistence has been lost.</h3>
                    {{#if datetime}}
                        <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
                    {{/if}}
                </div>
                <hr />
                <p>Disk is inaccessible on machine <a href="/#machines/{{machine_uuid}}">{{machine_name}}</a>. Please resolve the issue on the machine, or declare it dead.<p>
                <p><a class="btn large danger">Declare Dead</a></p>
            </div>
        </script>
        <script id="resolve_issues-vclock_conflict-template" type="text/x-handlebars-template">
            <div class="issue {{#if critical }}critical{{/if}} vclock-conflict">
                <div class="header">
                    <h3 class="title">Cluster configuration conflict.</h3>
                    {{#if datetime}}
                        <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
                    {{/if}}
                </div>
                <hr />
                <p>This issue is caused by making changes to the cluster configuration on both sides of an intermittent network connection.</p>
                <h4>{{capitalize field}} of {{object_type}} <a href="">{{#if name_contest}}{{humanize_uuid object_id}}{{else}}{{object_name}}{{/if}}</a> has the following conflicting values:</h4>
                <ul>
                  {{#each contestants}}
                  <li>{{value}} (<a id="resolve_{{contestant_id}}" href="#">use this value</a>)</li>
                  {{/each}}
                </ul>
            </div>
        </script>
        <script id="resolve_issues-unknown-template" type="text/x-handlebars-template">
            <div class="issue {{#if critical }}critical{{/if}}">
                <div class="header">
                    <h3 class="title">Unknown issue: {{issue_type}}</h3>
                    {{#if datetime}}
                        <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
                    {{/if}}
                </div>
                <hr />
                <h4>Whoops, this shouldn't happen. Please contact support and hope for the best.</h4>
            </div>
        </script>

        <!-- Events view -->
        <script id="events-container-template" type="text/x-handlebars-template">
            <h1>Log entries</h1>
            <div class="events"></div>
        </script>
        <script id="events-event-template" type="text/x-handlebars-template">
            <p class="datetime">{{prettify_date datetime}}</p>
            <p class="message">{{message}}</p>
            <div class="clearleft"></div>
        </script>

        <!-- Alerts -->
        <script id="added_namespace-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>You added namespace <span class="name">{{name}}</span>. You can now <a href="#namespaces/{{uuid}}">configure</a> it further.</p>
            </div>
        </script>

        <script id="removed_namespace-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>You removed namespace <span class="name">{{name}}</span>.</p>
            </div>
        </script>

        <script id="declared_machine_dead-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>You successfully declared machine <span class="name">{{machine_name}}</span> dead.</p>
            </div>
        </script>

        <script id="resolved_vclock-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>You successfully resolved the configuration value to <span class="name">{{final_value}}</span>.</p>
            </div>
        </script>

        <script id="added_datacenter-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>You added datacenter <span class="name">{{name}}</span>. You can now <a href="#datacenters/{{uuid}}">configure</a> it further.</p>
            </div>
        </script>

        <script id="renamed_item-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>You successfully renamed {{type}} from <span class="name">{{old_name}}</span> to <span class="name">{{new_name}}</span>.</p>
            </div>
        </script>

        <script id="removed_datacenter-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>You removed datacenter <span class="name">{{name}}</span>.</p>
            </div>
        </script>

        <script id="modified_replica-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>
                  You successfully changed
                  {{#if modified_replicas}} the number of replicas from {{old_replicas}} to {{new_replicas}}
                  {{#if modified_acks}} and{{/if}}
                  {{/if}}
                  {{#if modified_acks}} the number of acks from {{old_acks}} to {{new_acks}}{{/if}}
                  for datacenter <a href="/#datacenters/{{datacenter_uuid}}">{{datacenter_name}}</a>.
                </p>
            </div>
        </script>

        <script id="edit_machines-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>You successfully changed machine assignments.</p>
            </div>
        </script>

        <script id="changed_primary_dc-replica-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>You successfully changed the primary datacenter for namespace <a href="/#namespaces/{{namespace_uuid}}">{{namespace_name}}</a> from <a href="/#datacenters/{{old_datacenter_uuid}}">{{old_datacenter_name}}</a> to <a href="/#datacenters/{{datacenter_uuid}}">{{datacenter_name}}</a>.</p>
            </div>
        </script>

        <script id="set_datacenter-alert-template" type="text/x-handlebars-template">
            <div class="alert" data-alert="alert">
                <a class="close" href="#">&times;</a>
                <p>Set datacenter for {{pluralize_noun "machine" machine_count}} {{machines_first.name}}{{#each machines_rest}}, {{name}}{{/each}} to {{datacenter_name}}.</p>
            </div>
        </script>

        <!-- Modal dialogs -->
        <script id="add_namespace-modal-template" type="text/x-handlebars-template">
            <div class="modal add-namespace">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Add a namespace</h3>
                    </div>
                    <div class="modal-body">
                        <fieldset>
                            <legend>Namespace details</legend>
                            <div class="clearfix">
                                <label for="name">Name</label>
                                <div class="input">
                                    <input class="xlarge" name="name" size="30" type="text" />
                                </div>
                            </div>
                            <div class="clearfix">
                                <label for="port">Port</label>
                                <div class="input">
                                    <input class="xlarge" name="port" size="5" type="text" />
                                </div>
                            </div>
                            <div class="clearfix">
                                <label for="protocol">Protocol</label>
                                <div class="input">
                                    <select class="protocol" name="protocol">
                                        <option>Memcached</option>
                                        <option>Redis</option>
                                        <option>Riak</option>
                                        <option>MongoDB</option>
                                    </select>
                                </div>
                            </div>
                            <div class="clearfix">
                                <label for="primary_datacenter">Select a primary datacenter:</label>
                                <div class="input">
                                    <select class="primary_datacenter" name="primary_datacenter">
                                        {{#each datacenters}}
                                        <option value="{{this.id}}">{{this.name}}</option>
                                        {{/each}}
                                    </select>
                                </div>
                            </div>
                            <hr />
                            <div class="user-tip">
                                <p>* You can tweak configuration options for
                                the namespace once it's created.</p>
                            </div>
                        </fieldset>
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary add-namespace" type="submit" name="add-namespace" value="Add namespace">Add namespace</button>
                        <a href="#" class="btn secondary cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>

        <script id="confirmation_dialog-template" type="text/x-handlebars-template">
            <div class="modal confirmation">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Confirmation</h3>
                    </div>
                    <div class="modal-body">
                        <fieldset>
                            <legend>{{message}}</legend>
                        </fieldset>
                    </div>
                    <div class="modal-footer">
                        <a href="#" class="btn cancel">No</a>
                        <button class="btn" type="submit" name="yes" value="yes">Yes</button>
                    </div>
                </form>
            </div>
        </script>

        <script id="remove_namespace-modal-template" type="text/x-handlebars-template">
            <div class="modal remove-namespace">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Remove a namespace</h3>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to remove these namespaces:</p>
                        <ul class="namespace-list">
                            {{#each namespaces}}
                                <li><a href="#namespaces/{{id}}" target="_blank">{{name}}</a></li>
                            {{/each}}
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary remove-namespace" type="submit" name="remove-namespace" value="Remove namespace">Remove namespace</button>
                        <a href="#" class="btn secondary cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>

        <script id="declare_machine_dead-modal-template" type="text/x-handlebars-template">
            <div class="modal declare_machine_dead">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Declare machine dead</h3>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to declare <strong>{{machine_name}}</strong> dead?</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary declare_machine_dead" type="submit" name="declare-machine-dead" value="Declare dead">Declare dead</button>
                        <a href="#" class="btn secondary cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>

        <script id="resolve_vclock-modal-template" type="text/x-handlebars-template">
            <div class="modal resolve_vclock">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Resolve configuration conflict</h3>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to use the value <strong>{{final_value}}</strong>?</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary resolve_vclock" type="submit" name="resolve-vclock" value="Resolve">Resolve</button>
                        <a href="#" class="btn secondary cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>

        <script id="edit_replica_machines-modal-template-outer" type="text/x-handlebars-template">
            <div class="modal modify-replicas">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Replica machines for shard {{name}} in datacenter <a href="/#datacenters/{{datacenter_uuid}}">{{datacenter_name}}</a></h3>
                    </div>
                    <div class="modal-body">
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary commit-plan" type="submit" name="commit-plan" value="Commit changes">Commit changes</button>
                        <a href="#" class="btn edit-machines cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>
        <script id="edit_replica_machines-modal-template-inner" type="text/x-handlebars-template">
          <div class="current-replicas">
            {{#if change_hints}}
              <h4>Change replica assignments:</h4>
              <ul>
                <!-- We render this the same number of times there are replicas. -->
                {{#each machines}}
                <li>
                  <select class="pinned_machine_choice" name="pinned_machine_uuid">
                    {{#each dc_machines}}
                    <option value="{{machine_uuid}}" {{#if selected}}selected="selected"{{/if}}>{{machine_name}}</option>
                    {{/each}}
                  </select>
                </li>
                {{/each}}
              </ul>
              <p>* Replicas cannot be assigned to <a href="/#machines/{{primary_uuid}}">{{primary_name}}</a> because it's a master for this shard.</p>
              <a id="btn_change_hints_cancel" href="#">Cancel</a>
              {{else}}
              <h4>Current replica assignments:</h4>
              <ul>
                {{#each machines}}
                <li><a href="/#machines/{{uuid}}">{{name}}</a> {{humanize_machine_reachability status}}</li>
                {{/each}}
              </ul>
              <a id="btn_change_hints" href="#">Change assignments</a>
              {{/if}}
          </div>
        </script>

        <script id="edit_master_machine-modal-template-outer" type="text/x-handlebars-template">
            <div class="modal modify-master">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Master machine for shard {{name}} in datacenter <a href="/#datacenters/{{datacenter_uuid}}">{{datacenter_name}}</a></h3>
                    </div>
                    <div class="modal-body">
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary commit-plan" type="submit" name="commit-plan" value="Commit changes">Commit changes</button>
                        <a href="#" class="btn edit-machines cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>
        <script id="edit_master_machine-modal-template-inner" type="text/x-handlebars-template">
          <div class="current-master">
            {{#if change_hints}}
              <h4>Change master assignment:</h4>
              <ul>
                <li>
                  <select class="pinned_machine_choice" name="pinned_master_uuid">
                    {{#each dc_machines}}
                    <option value="{{machine_uuid}}" {{#if selected}}selected="selected"{{/if}}>{{machine_name}}</option>
                    {{/each}}
                  </select>
                </li>
              </ul>
              <a id="btn_change_hints_cancel" href="#">Cancel</a>
              {{else}}
              <h4>Current master assignment:</h4>
              <li><a href="/#machines/{{master_uuid}}">{{master_name}}</a> {{humanize_machine_reachability master_status}}</li>
              <a id="btn_change_hints" href="#">Change assignment</a>
              {{/if}}
          </div>
        </script>

        <script id="add_datacenter-modal-template" type="text/x-handlebars-template">
            <div class="modal add-datacenter">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Add a datacenter</h3>
                    </div>
                    <div class="modal-body">
                        <fieldset>
                            <legend>Datacenter details</legend>
                           <div class="clearfix">
                                <label for="name">Name</label>
                                <div class="input">
                                    <input class="xlarge" name="name" size="30" type="text" />
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary add-datacenter" type="submit" name="add-datacenter" value="Add datacenter">Add datacenter</button>
                        <a href="#" class="btn secondary cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>

        <script id="rename_item-modal-template" type="text/x-handlebars-template">
            <div class="modal rename-item">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Rename {{type}}</h3>
                    </div>
                    <div class="modal-body">
                        <fieldset>
                           <legend>Rename {{capitalize type}} from {{old_name}} to:</legend>
                           <div class="clearfix">
                                <label for="name">New name</label>
                                <div class="input">
                                    <input class="xlarge" name="new_name" size="30" type="text" />
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary rename-item" type="submit" name="rename-item" value="Rename {{type}}">Rename {{type}}</button>
                        <a href="#" class="btn secondary cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>

        <script id="remove_datacenter-modal-template" type="text/x-handlebars-template">
            <div class="modal remove-datacenter">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Remove a datacenter</h3>
                    </div>
                    <div class="modal-body">
                        <div class="alert block-message error">
                            <p>
                            <strong>Be careful.</strong>
                                If you remove these datacenters, all
                                replica counts in these datacenters will be
                                reduced to zero.
                            </p>
                        </div>
                        <p>Are you sure you want to remove the datacenter <a href="#datacenters/{{datacenter.id}}" target="_blank">{{datacenter.name}}</a>?</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary remove-datacenter" type="submit" name="remove-datacenter" value="Remove datacenter">Remove datacenters</button>
                        <a href="#" class="btn secondary cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>

        <script id="set_datacenter-modal-template" type="text/x-handlebars-template">
            <div class="modal set-datacenter">
                <form class="form">
                    <div class="modal-header">
                        <a href="#" class="close">&times;</a>
                        <h3>Set datacenter</h3>
                    </div>
                    <div class="modal-body">
                        <fieldset>
                            <legend>Which datacenter?</legend>
                            <label for="datacenter_uuid">Select a datacenter</label>
                            <div class="clearfix">
                                <select class="datacenter_uuid" name="datacenter_uuid">
                                    {{#each datacenters}}
                                        <option value="{{this.id}}">{{this.name}}</option>
                                    {{/each}}
                                </select>
                            </div>
                        </fieldset>
                    </div>
                    <div class="modal-footer">
                        <button class="btn primary set-namespace" type="submit">Set datacenter</button>
                        <a href="#" class="btn secondary cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </script>

        <!-- javascript -->
        <script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
        <script type="text/javascript" src="js/handlebars-1.0.0.beta.6.js"></script>
        <script type="text/javascript" src="js/underscore-min.js"></script>
        <script type="text/javascript" src="js/backbone.js"></script>
        <script type="text/javascript" src="js/bootstrap/bootstrap-tab.js"></script>
        <script type="text/javascript" src="js/bootstrap/bootstrap-modal.js"></script>
        <script type="text/javascript" src="js/bootstrap/bootstrap-alert.js"></script>
        <script type="text/javascript" src="js/bootstrap/bootstrap-typeahead.js"></script>
        <script type="text/javascript" src="js/jquery.sparkline.min.js"></script>
        <script type="text/javascript" src="js/jquery.validate.min.js"></script>
        <script type="text/javascript" src="js/jquery.hotkeys.js"></script>
        <script type="text/javascript" src="js/jquery.form.js"></script>
        <script type="text/javascript" src="js/jquery.timeago.js"></script>
        <script type="text/javascript" src="js/date-en-US.js"></script>
        <script type="text/javascript" src="js/d3.v2.min.js"></script>
        <script type="text/javascript" src="gen/cluster-min.js"></script>
        <script type="text/javascript">
            var reset_token = function() {
                token = "{{token}}";
            }
        </script>
    </head>
    <body>
        <div id="navbar-container"></div>
        <div id="dev-tools">
            <h3>Development tools</h3>
            <div id="live-data" class="btn" href="#">Pause live data feed</div>
            <div id="reset-simulation-data" class="btn" href="#">Reset simulation data</div>
            <div id="fetch-backbone-data" class="btn" href="#">Fetch Backbone.js data</div>
            <div id="make-diff" class="btn" href="#">Make diff</div>
            <div id="reset-session" class="btn" href="#">Reset session</div>
            <hr />
            <h3>Simulate events</h3>
            <div id="random-machine-failure" class="btn" href="#">Random machine failure</div>
        </div>
        <div class="container">
            <div class="row">
                <div id="cluster" class="span9"></div>
                <div id="sidebar-wrapper" class="span3">
                    <div id="sidebar"></div>
                </div>
            </div>
            <div id="modal-dialog"></div>
        </div>
    </body>
</html>
